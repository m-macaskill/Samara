#tag WindowBegin Window DataWindow   BackColor       =   &cFFFFFF00   Backdrop        =   0   CloseButton     =   False   Compatibility   =   ""   Composite       =   False   Frame           =   8   FullScreen      =   False   HasBackColor    =   False   Height          =   406   ImplicitInstance=   True   LiveResize      =   False   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   32000   MenuBar         =   0   MenuBarVisible  =   True   MinHeight       =   64   MinimizeButton  =   False   MinWidth        =   64   Placement       =   0   Resizeable      =   False   Title           =   "Untitled"   Visible         =   False   Width           =   865   Begin PushButton OKButton      AutoDeactivate  =   True      BehaviorIndex   =   0      Bold            =   False      Cancel          =   False      Caption         =   "OK"      ControlOrder    =   "0"      Default         =   True      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   765      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   False      TabIndex        =   0      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0.0      Top             =   370      Underline       =   False      Visible         =   True      Width           =   80   End   Begin PushButton cancelButton      AutoDeactivate  =   True      BehaviorIndex   =   1      Bold            =   False      Cancel          =   True      Caption         =   "Cancel"      ControlOrder    =   "1"      Default         =   False      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   661      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   False      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0.0      Top             =   372      Underline       =   False      Visible         =   True      Width           =   80   End   Begin dataListBox dataListBox1      AutoDeactivate  =   True      AutoHideScrollbars=   True      BehaviorIndex   =   2      Bold            =   False      ColumnCount     =   1      ColumnsResizable=   True      ColumnWidths    =   "60"      ControlOrder    =   "2"      DataField       =   ""      DataSource      =   ""      DefaultRowHeight=   -1      Enabled         =   True      EnableDrag      =   False      EnableDragReorder=   False      GridLinesHorizontal=   0      GridLinesVertical=   0      HasHeading      =   True      HeadingIndex    =   -1      Height          =   346      HelpTag         =   ""      Hierarchical    =   False      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   ""      Italic          =   False      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      RequiresSelection=   False      ScrollbarHorizontal=   True      ScrollBarVertical=   True      SelectionType   =   1      TabIndex        =   2      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0.0      Top             =   14      Underline       =   False      UseFocusRing    =   True      Visible         =   True      Width           =   825      _ScrollOffset   =   0      _ScrollWidth    =   -1   EndEnd#tag EndWindow#tag WindowCode	#tag Event		Sub Activate()		  self.mDataHasBeenEdited = false		  		End Sub	#tag EndEvent	#tag Event		Sub Open()		  'gLog "DataWindow opening."		End Sub	#tag EndEvent	#tag Method, Flags = &h0		Sub breakCircularReferences()		  // break circular references to allow memory to be freed up when a chartWindow is closed.		  // a cascade of these messages is initiated when a window is closed.		  		  mParentSession = nil		  self.close		  		  		  		exception err		  gHandleException err, "breakCircularReferences method of DataWindow class."		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub displayData()		  dim i, j, columns, rowsInData as integer		  dim temp as string		  		  		  columns = mData(0).count -1		  rowsInData = uBound(mData)		  dataListBox1.columnCount = columns + 1		  		  if not mHasBeenShownOnce then  // set up the row headers		    		    dataListBox1.columnWidths = ""		    		    for i = 0 to columns		      dataListBox1.heading(i) = mData(0).key(i)		      dataListBox1.columnType(i) = ListBox.TypeEditable		      if i <> columns then		        temp = temp + "60, "		      else		        temp = temp + "60"		      end if		    next		    dataListBox1.columnWidths = temp		    mHasBeenShownOnce = true		    		  end if		  		  // add/ delete rows if required		  if rowsInData <> dataListBox1.listCount - 1 then		    dataListBox1.deleteAllRows		    for i = 0 to rowsInData		      dataListBox1.addRow ""		    next		  end if		  		  		  // fill in the content		  for i = 0 to rowsInData		    for j = 0 to columns		      dataListBox1.cell(i, j) = mData(i).value(mData(i).key(j))		    next		  next		  		  		exception err		  gHandleException err, "displayData method of DataWindow."		  		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub editDataValue(label as string, index as integer, contents as string)		  // called in response to the user editing a cell in the DataListBox.		  // We get sent the label of the column and the row the cell is in, as well as the contents of the edited cell.		  		  mData(index).value(label) = contents		  mDataHasBeenEdited = true		  		  		exception err		  gHandleException err, "removeDataAtIndex method of DataWindow."		  		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub removeDataAtIndex(index as integer)		  // called in response to the user deleting an entire measurement in the DataListBox		  		  mData.Remove(index)		  mDataHasBeenEdited = true		  		  		exception err		  gHandleException err, "removeDataAtIndex method of DataWindow."		  		  		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub returnDataIfEdited()		  // called in response to the user pressing the OK button.  If the data has been changed, it needs to be sent back to the session.		  		  if mDataHasBeenEdited then mParentSession.returnEditedDataToSet(mData)		  		  		exception err		  gHandleException err, "returnDataIfEdited method of DataWindow."		  		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub showDataForEditing(data() as dictionary, callingSession as iViewSession)		  dim i, j, columns, rowsInData as integer		  dim temp as string		  		  // the callingSession parameter gives a place to send back the data if it is edited.		  mParentSession = callingSession		  // store the measurement dictionaries for further use		  mData = data		  // display them		  self.displayData		  		exception err		  gHandleException err, "showDataForEditing method of DataWindow."		  		  		End Sub	#tag EndMethod	#tag Property, Flags = &h1		#tag Note			The movement measurements are stored here so that they can be edited and then returned to the calling session if required.		#tag EndNote		Protected mData(-1) As dictionary	#tag EndProperty	#tag Property, Flags = &h1		#tag Note			Keeps track of whether the user has edited any items in the displayed data.		#tag EndNote		Protected mDataHasBeenEdited As boolean = false	#tag EndProperty	#tag Property, Flags = &h1		#tag Note			Used in the displayData method		#tag EndNote		Protected mHasBeenShownOnce As boolean = false	#tag EndProperty	#tag Property, Flags = &h1		#tag Note			A reference to where to send back any edited data.		#tag EndNote		Protected mParentSession As iViewSession	#tag EndProperty#tag EndWindowCode#tag Events OKButton	#tag Event		Sub Action()		  self.returnDataIfEdited  // returns data to the session object if required		  self.hide		End Sub	#tag EndEvent#tag EndEvents#tag Events cancelButton	#tag Event		Sub Action()		  self.hide		End Sub	#tag EndEvent#tag EndEvents